{% extends "base.html" %}

{% block title %}Maintenance Calendar{% endblock %}

{% block head %}
<style>
    /* container adjustment */
    .calendar-container {
        padding: 2rem;
        background: white;
        margin: 2rem auto;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        max-width: 1200px;
    }

    #calendar {
        max-width: 100%;
        margin: 0 auto;
        font-family: 'Plus Jakarta Sans', sans-serif;
    }

    /* Customize FullCalendar Header */
    .fc-toolbar-title {
        font-size: 1.5rem !important;
        font-weight: 700;
        color: #2e384d;
    }

    .fc-button-primary {
        background-color: #6366f1 !important;
        border-color: #6366f1 !important;
    }

    .fc-event {
        cursor: pointer;
        padding: 2px 5px;
        border-radius: 4px;
        font-size: 0.9em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="calendar-container">
        <div id="calendar"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: '/api/calendar/events', // Fetch from our Flask API
            editable: false,
            selectable: true,

            // On Date Click -> Go to New Request Form with date pre-filled
            dateClick: function (info) {
                // Convert YYYY-MM-DD to pre-fill URL
                // The new_request route expects POST for creation, but we can't pre-fill easily via GET 
                // unless we update new_request to read args.
                // For now, let's just go to the page. 
                // A better approach would be ?scheduled_date=...
                window.location.href = "{{ url_for('maintenance.new_request') }}?date=" + info.dateStr;
            },

            eventClick: function (info) {
                if (info.event.url) {
                    // If URL exists, let default behavior happen (navigate)
                    return;
                }
                // Otherwise show info
                alert('Event: ' + info.event.title + '\nDate: ' + info.event.start);
                info.jsEvent.preventDefault(); // don't let the browser navigate
            }
        });
        calendar.render();
    });
</script>
{% endblock %}